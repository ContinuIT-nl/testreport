// Widths of the characters in the font Verdana 110pt as bytes encoded in base64.
const verdanaWidthsBase64 = 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnKzJaRnhQHjIyRlooMigyRkZGRkZGRkZGRjIy' +
  'WlpaPG5LS01VRj9VUy4yTD1dUldCV0xLRFFLbktESzIyMlpGRkJFOUVCJ0VGHiZBHm5GQ0VFLzkrRkFa' +
  'QUE6RjJGWgA9bm5ubm5ubm5ubm5ubjdubm5ubm5ubm5ubm5ubm43bicrRkZGRjJGRm48R1oAbkY8Wjw8' +
  'RkdGKEY8PEdubm48S0tLS0tLbk1GRkZGLi4uLlVSV1dXV1daV1FRUVFEQ0RCQkJCQkJuOUJCQkIeHh4e' +
  'Q0ZDQ0NDQ1pDRkZGRkFFQUtCS0JLQk05TTlNOU05VUdVRUZCRkJGQkZCRkJVRVVFVUVVRVNGU0YuHi4e' +
  'Lh4uHi4eYEQyJkxBQT0ePR49IT0yPh9SRlJGUkZQUkZXQ1dDV0N4bkwvTC9ML0s5SzlLOUs5RCtEK0Qr' +
  'UUZRRlFFUUZRRlFFblpEQURLOks6SzohRU1ARUs+TEw7U2BARUE8Uzo7Rk9IZCsrSUAqQXhRRFZZQ3hi' +
  'SkVGOzhBOilKKUZTSVZOREpDPz09ODlGRjQyQx0wMiCMjIJeWj1ubmNMPSAgVURMRExEUUZMRFFGPUw9' +
  'TD1kXlhFT0VIQFVEVUQ9OByMjIJVRW49UkZLQm5uV0NIPEw9Pzo8PR4bICBMP1VERCVGLUc9TERLOUQr' +
  'OjdRRFFkVURDP0w9PD1VRFVEVURVREU5P2Q/HGRkS1E4PkQ3Nz4+UV9LSz49GWBFVyxWRT1FRUU4PUZG' +
  'PUJWMzNHQC1GRUE7QURERCopLTg1IUhkZGRFRkVEWVZULS0vLS0tLT09OC8wNTspKUhJRDlVOTU/TTg7' +
  'MTExNVU6QUNFNUAzRjIxbm6CWE5gbkpNREBHRygoGhsbIyMzJBo0IxYcHR0fHyYnKChGRhRGHx8UKB8f' +
  'KiofHzIyMjJGRkZGRkYXJikUIygfKysrKysqKiUuMBgYGhogHy8vKRsfHx8fKioyAAA1ADNENCcxAC4z' +
  'NSYvADQ0JycnCy4vLCwaESkwMDAwGRkAMS4VKCkmKDk1NTQ0NDNERD4+RD5PKQAoOTApRAAANCo1Jigz' +
  'Ly00NDQ5LAAtKTQwLS04KRQwMy9TNDMzMzMzLSwkLSwsLSwzKCktLS4lQTMgIE9AT09EODg4MkJPT09P' +
  'RkZLMlNgO09hT1NkHktLPk1GS1NXLkxLXVJHV1NCT0pERFpLYFouREU4Rh5FRURBQzgyRkUeQUFGQTdD' +
  'RkU4RTdFV0FaWR5FQ0VZPjlAOztGVVY9VURJOzs4PDhJWGJcSj1KN0lJQ0JRPTMtPUM4IVY6Oj9DTF9Q' +
  'TlFRUUZGVz5NSy4uMnh4WkxTRFNLS0s+UkZuRFNTTFFdU1dTQk1ERFpLVE5ublZkS01uTkJEQTREQlg6' +
  'RkZBRE1GQ0ZFOzdBXEFHQ2BiRlc/PFxCQkJGNDw5Hh4mZGRGQUZBRmFVRTxjUkI7YVNeUXhuOTVMTUs/' +
  'RTdFN4JuSz5gVGFVRztFAAAAAAAAAE4/RTxGPj40PjRDN25YQThMQUxBSDlaTFNGbk5uYFJCSDpCNURB' +
  'REFLQWNKSzxOQ05GVUFVQR5kVEU8TkBOPk4/SzxgUh5IPEg8ZF0/OlNCTDpkVEE4QEBOP04/TD9XQ0s/' +
  'SjtFNEU0RTRLPD0uX1VBLUU3RTdEPlpfV0c7N25ZbltEOU5GSjtOQFRMW0tuUVVEZFdLRW5YeGRMQkpE' +
  'MSxiWT46SUFPVD9RUURHPzxQS0A5UEhCQU1PRFA9UUY7QklDUURRPTY/RUtFQE1PTywlISodJgBPUjhD' +
  'Rjc6NDg/PzceVDo2NzM5OjoeODA6LVEwQzo6U0Y4K1FBN0U7TycsT09PT1hPAAAAAAAAAAAAAAAAAAAA' +
  'AAALAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAMPAAAAJgAcAAAcAAUsDE9PT09PT09PRz4vN04jJU5HIzo/' +
  'O01MIi1JQjo/NT9JOE9MT09PT09EREIfNU9PT09PT09PT09PYb5dUSJ4R0dWOjo1IDFdOgAAAQAAAAAA' +
  'AAAJIABPGydZIyAgKyBGIEYnRkZAQEAtLS0tZGR4eEJCQEBNTUZGRhZWPDw0LTsnK0ZGAAAAAAAAAAAA' +
  'AAAAAAAAAAAAAAAAOjo6Ojo6Ojo6Ojo6OjlGPAAgICAALzo2RkZGRkZGRkZGQEBAQEBAQC0tLS0tLS0t' +
  'LS0tLS0tLS0tLWRkZHh4QkBWVlZWVlY8PE1NTTw8PE1NTU1NTTQ0NDQ7Ozs7OzlAJzExMSsrKysrKysr' +
  'Rk9GK0ZGQEAjJwcEAAAAAABfPQAAAAAYABkmAABGAAAAAC0tMzM6Ojo6Ojo6OmR4QDMwOU9PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PRkZGRkZGRkBALS0tZEBAQFZWTU1NLS07Ozs0LS1kQEBkLUAgIEZGRisrQEBAZGQ8' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PYGBKVGRKRjZTUz0v' +
  'QBo0eFw0JUlYT2BgYCZTZEpCT09PT09PT09PT09PT09PT09PT09PT086KCkiIU9PT09PTzg+TwAAAAAA' +
  'AAAAAAAAAAAAAAAAAAAAAAAATwAAAAAASUlJZFBQbjo6NEpbTzw8PDxubm5uVVc9RkRHS1JVTTc/PDpT' +
  'PUc6Rjg4Plc+QEBDLC1OUVE8Tz9LOElkSTZkZGRJSUlJSUlJSWRkZGRJZGSCAABJSUlJSVVXPVI8OldD' +
  'W09JSTRSMzU2Njg7Okg1NDciUFBublBQOVJDPVAyPT4+SXh4T2KCNkhJS1NET09OU09PQk5MSEZFTDpB' +
  'WFVkPDxJPENLSjxDRU9IUzxPQD48T1FPT09NPkg2T09JM2RkZElJSUlPT2RkT0+Cgkk5T09PT09PT09k' +
  'T09PT0k8Tz5TRElJT09BOjVQN0NGPkxFPTwuQixLRh4+OkYeT09PT08iFyBPWW5hYk5OT09PT0lZT09O' +
  'WUxMWlxLTE9MT0lJT0tMTktMTExPT0xLTUtLW0lPTk5PTEtPS0lPTwxPGhcyQEBPT09PPj5PT0M6E09P' +
  'TxNPT09PT09PTFpMS09LT09PT09PT11ERUZNTEZGUE0kGklOqi5PT09PT09PT09PT1lZHE9eeEdOUl9Y' +
  'U15PXl54T3h4P1RPRkFKVlxcTEZPP0xiR0o/R0lPSj9VWUNKOE9KWk9KT0pRQU9PWTh4ZHhZWVlZWU9Z' +
  'WXhPeHhZT094T09PT09PT09PT09PT09PX1NZWU9PSi44PkhKOVU7Sy9kT09PT09PT09PT09PT09PHC4w' +
  'T1RkWFpbWlo+T09GW09PS19XVFRUXlNGV1RPVFVUVE9USlVJT09LXlVYS1JXT1dXT1VQS0tVT08FMmJO' +
  'Yk5OTk5PT4yMT0+Wlk5PT09PT09PT05iT09PT1RUT1pZQE5OT09DODhbRTtGPjc9UT8TLEY5UVtPT09P' +
  'T09PT09PPkxPYnhkRWR4T09PTk5WT1NTqk5PT09bR09TT2RVT09PjEtPT09KZEBPT09JTDtGWF1JUGRk' +
  'boJPT09PeFBAbnhPT0+MgqBPvrTmPk9PXE9PT09PT5ZPT09PT09PT09PT08kNztFRUFCUVtGX1pOTFVb' +
  'UKBRgoxRbk9PT09PSW6Mbk9hXlVuY4Kgbk9UVFlPU1NVOWNCeFVYWFSMbl1EWlpcWlpaWlRPVFRaWniM' +
  'RGFVR2FUPVRUeE9PT0ZuSUlujHiWT0lJSU9JSW5JT09PT09PT0lJT1hUWk9PT09PyJZJSU9PQD5NN0FH' +
  'MjlBMk9PT09PT09POhw0UkpKSVYqPXhdT1pVXHh4jHhuT1FRVE9RUVREXkZXUVFfUYx4VUlSUlVRWFhY' +
  'UE9RUVZWeIxJWlpTT1NIUVNXT089NHhHbmSCWYJPSm54T4y0bm5PT09PT09PYVlPT09PT09PWk+WlkVQ' +
  'T09IQ1VTU1xVUmNDTztPT09PT09PT09PT09PT09PKh9PjJZjtEaWWG5PeHi0T0Z4lmFYU4JuW4JYoIw5' +
  'QHh4jGBRPVxcZE5ugkBAYUM/VEg/WF5ueHhRT08qbllYYGBkZE+CeLRPqqDIQhNPT09PT09PT5ZPT09P' +
  'T09PT1h4RlFPT0BWWG5EYYIwWGRcYIJMUm5PT094lmREbl5uT09EME9bgoKCXFpflpbIbqpkbqBkZKpP' +
  'T094bmRebnhkWli0qpZkX2RuZIyCbmBTbmRPZFhkbnhuZGNYT2NPT2FuWGR4bmRPT09WT09PT3iCgllZ' +
  'WU9ZT4ygoNy+vtyWT09PT09PT09PT09PT09PT09PyD+gT09PT09PT09PT08VQj8/RkVGNDpDQEFaWklJ' +
  'O0xeWkVFQkU9REhIQUFKSklFQzVCQEk4RUdCRUpAP0QwODhuODg4ODg4OE9PT09LI0A4PS45Qzg4ODg4' +
  'ODg4UUBESEtEQkBURElVjE9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09EPE8+T084' +
  'PU88T08+T09PT09PQEJFR09EOjpKSUlKT0Q9PE89TztPTz1UTz09OjgALy8AAAAAAABPAAA2T08mQSUl' +
  'JU9BTwAAAAAkAE9PPTg3Pzg6RUVJRU9Pbm5PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'RTZVVYJCgqAqP0cSEhsyGxsieEEoRzRTLSUgNzciNzomJjw5TDc/PzQ4ODw5TDc/Pzg4NzopNyE8BpaW' +
  'NjYfLzk5OTg0Ozk0TzM0NDQ4NDQ0NDg0OTk5ODk7OTQ4NDQ2ND42Ozk5OTRCODY6Ok9PT088Nzw9eDh4' +
  'OHg1Njk5FjM2PCkpDzkpJQA6NDpPT09PODg4ODg4ODhPODg4ODg4ODg4ODg4ODg4ODs4ODg4ODg4ODg4' +
  'ODg4ODg4ODg4Tzg4QCs2QS0kMkcnPUJARE9GN9w0F4I1RkhDRk9PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT3hCRHhCRHhCVG54S0JLRIJ4eD9ERURERHhEeEN4RHh4Qm5PeIJCQkFPgvBP' +
  'eEFBQUF4QU9PT0FBWkRBTFFBQapEQkJCQkJEREREFytCUUJhREREREJeeKpBQU9PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JSk5N' +
  'Q1dJVj5GVk1FS05MUURBS0tOR0VFRUZVQUlFSlE/Q0NKV09PT09PT09PT08zP0BkODxQbkE1gjc4Xzk7' +
  'WzZVXFY4WDM6NT44OD83VzRKPzw2PF1CQkJCO0JPT09fX19fX19fX19fX19fX19fX19fbm5ubm5ubm5u' +
  'bm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5u' +
  'bm5PT09PTwAAX19fX19fX19fX19fX19fX19fX19fbm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5u' +
  'bm5ubm5ubm5ubl9ubm5fT09PT09fX19fX19fX19fX19fX19fX19fX19fX19fX19ubm5ubm5ubm5ubm5u' +
  'bm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5uT09PT09PTGNHSUhQY3hHW1tH' +
  'XlF4X26Cgm6Cbm6CeJaCeIJ4eIJugm5ubnhubkNOTGNcRFpjSmFhSmBKSmFUZGRUZFhUZF5eXl5eXl5e' +
  'bk+CXl6CT09hYWFhYW5hT25PjGFheE9PTmNjTmJkTmNUZGRUZGRUZFVVVVZWVVVVVVZVVlVkV1VMX1pM' +
  'WUpubm5PblNZbk9POk1IRkdLV1FTYFtTWVNkVkZfX0ZeSEdXT2RkT2RPT2N4T25fZG5PT2J4eGJ4YmJP' +
  'jE+CeHiCT09keGRkZIJkgkpiX0hfSE5PUmRkUmRjUmR4eHh4eIx4eEBQW0FkTVpuVG5uUmRdW25UbmRO' +
  'ZGNbZFVublRuZFxuQFxDRkJYQE9uT2RFUWRPT1FkUVFRYVdReIyMeIx4eIyWlpaWtJaWlklhX0hfXUpf' +
  'TGJhSWBfTV9KYkxDTEhNW15fZF9uXF5cVVZVVlVVVVVZgmRPT09PTmQhRCcnJzchZD04OzxIQkNHPi5S' +
  'UmA8R1daOj5uT09PqqCCqnhuYoxubniMbmFWeCA8ICA8TDNjbjhPT09PT09RSkdNbilGUDtFUTZCZERh' +
  'Mj54ZEZCUGM5W1pbRE5TO1NkST9EWEiCWWRuOVd4P0c4SEo2ZD9MVFRROlxOQ0NMSV8+TFtQUEdWWnhT' +
  'Xj8/gkpYSVhET09POEMuSjJPT09PV1dXV1JSUlJSUlJYWFhYWFhhZGFkUmRhZGFSSUE2IyMyMiY1NyMX' +
  'LC0seGJueFtbW1tUVFRUVFRUXFxcXlxbX2RfZGRfZF9ULg8oWlpaWk1NTU1NTU1uZGRuZG5bXFtcXFtc' +
  'W10mbm5gYEVFRUVFRUVFRVRUUVdRV1RUVFRUVFRUVCsrVVhXV0hISEhISEhISFdXV1dXV1dXV1dXV1dX' +
  'VykpR0REREREREREUFZUTVRNTVRNVFRNVE1SJiYmL0NkZGRkZGRkZGR4eHhkeGRkPDI8YGBgYGBgYGBg' +
  'bm5ubm5uYG5gbm5hbmE3MUpBQUFBQUFBQUFNUFBNUU1GVUZVUVNWTlAnLSc3JycneHhubl9fX0tLS0tu' +
  'bm5ubm5aWlpaWlpaWjlAQEBAQEBAQEBPT09PT09ST1JPT09PT08mMyUlZGRkZGRkREREREREU1MoMUpZ' +
  'WVlZXl5eXm5uNlxcXFxcXFJSUlJiYjJaWk1NQlpaTU1WVlZUVFRUNk4lbm5ubm5ublJFRUVFWVlZWYKC' +
  'gm5ugoI8XUVFRUVkZGRkPGBgYGBgYDdAQEBAQEBAJj84ODg4Pz8/P1BQUFBQUFBQUFBQUFtbU1NTU1tb' +
  'U1NTU1tbVFRUVFtbVFRUVFhYS0tLS1hYR0dHR1paTExMTCxubj4+Pj5ubklJSUlubklJSUk0SEhiYmJi' +
  'bm4+Pj4+WlpLS0tLRkZGZGRkZGRKSmRkZGRkZEVFRUVkZEdHR0dgYEVEREVubkZGRkaCgkBAQEBUVExM' +
  'TEwtLVRUTExMTG5uPj4+Pm5uRERERClubkZGRkZubj4+Pj5ubkZGRkZFNW6goKqMjKCgT09PT09PT09P' +
  'NjZMYniMNkxieIw2TGJ4jDZMYniMUYxueIxiUVFPT09DQzQ0ND81NSs3NztFLS1FQzcyQUFBRkVFNSkp' +
  'Rx5HLUcUHlJURy1HQE87KRQgQ0MrMjUtNS1BQTggKzJCNkNBbkduT0VBOBRDNT4gID5FODBPT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT0JCQmRCQkJCjGRCQkJkjEJCREJCQkJCQkJkJ2QnQkJkZG5AQmRCZEJCTkRC' +
  'QkJCQkJCQkIAAF49PT09NDQ0Y25uW1tigow0V080QjQ0NTQ0NDQ0NDNEJjrIR4IqOjZPTzo6SWFBQUFN' +
  'QT5PT09PT08pLRJILSwfOx8xT09PT09PPhggISo9FCEkJRQAAAAAbjpFNi8+Lz05OT9ubm5ubm5FQjUv' +
  'Ly80NjsrMzQyRjo9LzgrKikqKCsnPTE1LC81PEcsIyAvNDI/MTI4OTI5OjcwKi8xJykpLjEsPTYwQygt' +
  'Myo5UjAwMjAwLSo3PT45MTI4OypUKzM5bm5ubm5ubm4xIzY6OSpALDQzOi4tJS0oKio1PD83LzEqNjAu' +
  'PzM4OjgvQzQ/PiAtM0Jubm5ubm5PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PRzpJYUFBQU1BPoyMjKCMjEY6SWFBQUFNQT6MjIygjIxPT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09P' +
  'T09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT08+TV1AQEZIOTQgJT40UEVJ' +
  'QElJSmREQkI4Pj42REpcSj1VPzkwQDY5RTg/QSMwIScoHx8lJxMYIx0tJiYqKCAjISYsJycoOSgoJCQf' +
  'HygVJjwoKCEoKCgbKCw8IygoJyc2KBUcKSQoKCc3JmRERihcPUUsKDcoNz0qPWIYGD08Pz09H043GFw9' +
  'PSU3Kzc3Nz09PT0yMkgYNxg9PCknJikjGRkpKhEREREeEREePz8qKioqKSURGCorKicjJycnKSs0NAAA' +
  'NDQ0NDg4Jjk5MCkrT09PPDo7NS4wME8sLiEqLy0sKy8tKi1PT09PT09PT09PT09PT09PT09PT09PTwAA' +
  'SDw/RUtFP0VNOVJFVUVSRVJFUkVGQkZCPD08PTw9OyhPRVFEU0ZRRFFEUUQgIC4eTEFMQUhAPR47IDsg' +
  'OyBdbl9kXW5RRFJGUURRRFdDVURXQ1dDQkU9RUYtTC9GLUYtOzhLOTs4Ozg7OEYpRCtGKUYpTERMRExE' +
  'UUZMREtBS0FuWm5ablpeVW5aRUNFQ0U5Qz9LOkM/RClVOT0kLy5cN0tCS0JLQktCS0JLQktCS0JLQktC' +
  'S0JLQkZCRkJGQkZCRkJGQkZCRkIuHi4eV0NXQ1dDV0NXQ1dDV0NZQ1lDWUNZQ1lDUUZRRlNJU0lTSVNJ' +
  'U0lEQURBREFEQWRBODEyMkxMTExMTExMTE9kZGFiVlQ0NDQ0NDRPT09PZGRkZE9PRERERERERERkZHh4' +
  'eHhuZCgoKCgoKCgoMzNJS0lKPDhERERERERPT2RkgoJ4TE9PQkJCQkJCQkJPYE94T3hPZGNjY2NjY2Nj' +
  'ZG6Cgnh4bm5FRTg4RkYeHkNDRUVZWU9PTExMTExMTEx4eIyMjIyCeEREREREREREjIygoKCglpZjY2Nj' +
  'Y2NjY4yWqqqgoJaWTExMTExPTExMTEtLeEQeRERERERET0RERlNTYHhEREQoKB4eT08oKCAgLjtPRERE' +
  'QkJFRUNDQkJGRkRTUEZGRk9PY2NjT2NjV2FaZIJGRE83bjduJRwSRigWBwAAAAAAQEBGRm5uQUYeHh4e' +
  'MjIyMkZGPDQlNFojAAAAAAAAABOqlig9PSQ8UycyMk9FLkY3NzNkJCgkJFlOTkZGPDw1Izc1PW43TUFu' +
  'QUFuQU1uHxgAAAAAAAAAAAAAAAAAAAAALhhPTzw8Ljw8Li4uLhkZPC4uLi4uLi4uLi4uLi4ZGU8fHx8c' +
  'H0JCQkJCQkJCT09PRk1NRkZuUoKCblxF';

const widths = atob(verdanaWidthsBase64).split('').map((c) => c.charCodeAt(0));
const missingWidth = widths['x'.charCodeAt(0)];
// Future: collect info from kern table to get kerning information

export const getWidthVerdana110 = (str: string) => {
  let i = 0;
  let width = 0;
  const l = str.length;
  while (i < l) {
    const code = str.charCodeAt(i);
    if (code >= 0xD800 && code <= 0xDBFF) { // first part of a surrogate pair
      width += missingWidth;
    } else if (code >= 0xDC00 && code <= 0xDFFF) { // second part of a surrogate pair
      // do nothing
    } else {
      width += widths[code] ?? missingWidth;
    }
    i++;
  }
  return width;
};

export type BadgeSvgOptions = {
  label: string;
  message?: string;
  labelColor: string;
  messageColor?: string;
  rounded: boolean;
};

const margin = 50;
const shift = 10;
const bottom = 138;

const emitText = (svg: string[], text: string, width: number, x: number) => {
  svg.push(
    `<text x="${x + shift}" y="${bottom + shift}" textLength="${width}" fill="#000" opacity="0.1">${text}</text>`,
  );
  svg.push(`<text x="${x}" y="${bottom}" textLength="${width}">${text}</text>`);
};

export const createBadgeSvg = (options: BadgeSvgOptions) => {
  const { label, message, labelColor, messageColor, rounded } = options;
  const labelWidth = getWidthVerdana110(label);
  const messageWidth = message ? getWidthVerdana110(message) : 0;
  const width = labelWidth + messageWidth + (messageWidth ? 4 : 2) * margin;
  const height = 200;
  const ariaLabel = `${label}${message ? ' ' : ''}${message ?? ''}`;

  // svg header and title
  const svg = [
    '<svg xmlns="http://www.w3.org/2000/svg" role="img" ',
    `width="${width * 0.1}" height="${height * 0.1}" `,
    `viewBox="0 0 ${width} ${height}" aria-label="${ariaLabel}">`,
    `<title>${ariaLabel}</title>`,
  ];

  // clip path to round the corners
  if (rounded) {
    svg.push(`<g><clipPath id="r"><rect width="${width}" height="${height}" rx="30" fill="#fff"/></clipPath></g>`);
  }

  // backgrounds
  svg.push(`<g clip-path="url(#r)">`);
  svg.push(`<rect fill="${labelColor}" width="${labelWidth + 2 * margin}" height="${height}"/>`);
  if (message) {
    svg.push(
      `<rect fill="${messageColor}" x="${labelWidth + 2 * margin}" width="${
        messageWidth + 2 * margin
      }" height="${height}"/>`,
    );
  }
  svg.push('</g>');

  // text
  svg.push(`<g aria-hidden="true" fill="#fff" font-family="Verdana,DejaVu Sans,sans-serif" font-size="110">`);
  emitText(svg, label, labelWidth, margin);
  if (message) emitText(svg, message, messageWidth, 3 * margin - shift * 0.5 + labelWidth);
  svg.push('</g>');

  // footer & return svg string
  svg.push('</svg>');
  return svg.join('');
};
